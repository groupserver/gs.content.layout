<tal:block 
  metal:define-macro="page"><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <metal:block define-slot="title" />

    <tal:block  metal:define-slot="metadata-global"
      tal:condition="python:hasattr(context, 'metadata.xml')"
      tal:replace="structure python:getattr(context, 'metadata.xml')()">
      &#160;
    </tal:block>
    <link rel="home" href="/"
      tal:attributes="title string:${view/siteInfo/name} Home;"/>
    <link rel="help" href="/help"
      tal:attributes="title string:${view/siteInfo/name} Help;"/>
    <tal:block  metal:define-slot="metadata" />

    <!--Favourite Icon-->
    <link rel="shortcut icon" type="" href="/++resource++favicon.ico"/>

    <!-- styling typically covering all sites -->
    <link rel="stylesheet" type="text/css"
      href="/++resource++globalstyle-20120604.css" />
    <!-- styling just covering local customisations to sites -->
    <link rel="stylesheet" type="text/css"
      href="/++resource++site-20110714.css" />
    <tal:block
        condition="python: hasattr(context, 'PresentationCustom')">
        <!-- now deprecated, but still in use, method for getting 
           - local customisations -->
        <link rel="stylesheet" type="text/css" 
          href="/PresentationCustom/Tofu/Common/css/globalstyle.css" />
    </tal:block>
    <metal:block define-slot="style" />
    <base 
      tal:define="hasIndex python:'index.html' in request['URL'];
        url python:(hasIndex and ('%s/' % request['URL1'])) or request['URL']"
      tal:attributes="href url" />
  </head>
  <body tal:define="siteName view/siteInfo/name | nothing"
    tal:attributes="id python:'page-%s' % request.URLPATH1.strip('/').replace('/','_');">
    <div id="toparea">
      <div id="externalbar" 
        metal:define-slot="externallinks"
        tal:content="structure python:getattr(context, 'menuexternal.xml', getattr(context.Templates.output, 'menuexternal.xml'))(method='html')">&#160;</div>
      <div id="titlebanner">
        <div id="titlebar">
          <a href="/"><span class="logo">&#160;</span>
            <span class="group">&#160;</span>
            <span class="division" tal:content="siteName">Site Name</span></a>
        </div><!--titlebar-->
      </div><!--titlebanner-->
      <div id="mainnav">
        <div id="utilitylinks" metal:define-slot="utilitylinks">
          <ul tal:define="userId user/getId;">
            <li tal:condition="not:userId" id="utilitylinks-log-in">
              <a id="utilitylinks-log-in-link" href="/login.html"
                 tal:attributes="href url;"
                 tal:define="url string:/login.html?came_from=${request/URLPATH0};"
                 title="Log in here">Sign in</a>
            </li>
            <tal:block condition="userId">
              <li class="ui-state-default ui-corner-top">
                <a id="log-out-link"
                  tal:attributes="title string:Log out from ${siteName}"
                    href="/cookie_authentication/logout">Log Out</a>
              </li>
              <li  class="ui-corner-top"
                tal:define="fn python:user.getProperty('fn','?');
                  nn user/get_canonicalNickname;
                  url string:/p/${nn};
                  up1 view/request/URLPATH1;
                  cur python:up1==url;
                  c string:ui-state-default ui-corner-top ui-tabs-selected ui-state-active;
                  nc string:ui-state-default ui-corner-top"
                tal:attributes="class python:(cur and c) or nc">
                <a id="profile-link" title="View your profile"
                  tal:attributes="href url;
                    class python:(cur and 'current') or 'not-current';">
                  <span class="fn" tal:content="fn"/>
                  (profile)</a>
              </li>
            </tal:block>
          </ul>
        </div><!--utilitylinks-->
      </div><!--mainnav-->
    </div><!--toparea-->
    <div id="bodyblock">    
      <div id="divisionHomeContent">
        <metal:block define-slot="messages">
          &#160;
        </metal:block><!--messages-->
        <metal:block metal:define-slot="pagetitle"/>
        <div id="notifications" metal:define-slot="notifications"
          tal:define="notifications context/notifications | nothing"
          tal:condition="notifications">
          <tal:block 
            repeat="notification python:notifications.objectValues()">
            <p tal:replace="structure python:notification(method='html')">
              You Maniacs! 
              You blew it up! 
              Ah, <strong>damn you!</strong>
              God damn you all to <strong>Hell!</strong>
            </p>
          </tal:block>
        </div><!--notifications-->
        <metal:block define-slot="body" />   
        <div class="noFloat">&#160;</div>
        <!--Footer-->
        <metal:block metal:define-slot="footer"
          tal:content="structure python:getattr(context, 'footerlinks.xml', getattr(context.Templates.output, 'footerlinks.xml'))(method='html')" />
      </div><!--content-->
    </div><!--bodyblock-->
    <script type="text/javascript" 
      src="/++resource++jquery-1.4.4.min.js">&#160;</script>
    <script type="text/javascript"
      src="/++resource++disclosureButton-20100809.js">&#160;</script>
     <script type="text/javascript"
      src="/++resource++disableSubmit-20091123.js">&#160;</script>     
    <metal:block define-slot="javascript" />
  </body>
</html>
</tal:block>
